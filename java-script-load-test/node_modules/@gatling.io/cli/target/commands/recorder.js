"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const options_1 = require("./options");
const simulations_1 = require("../simulations");
const dependencies_1 = require("../dependencies");
const log_1 = require("../log");
const run_1 = require("../run");
exports.default = (program) => {
    program
        .command("recorder")
        .description("Run the Gatling recorder")
        .addOption(options_1.gatlingHomeOption)
        .addOption(options_1.sourcesFolderOption)
        .addOption(options_1.typescriptOption)
        .addOption(options_1.resourcesFolderOption)
        .action(async (options) => {
        const gatlingHome = (0, options_1.gatlingHomeOptionValueWithDefaults)(options);
        const sourcesFolder = (0, options_1.sourcesFolderOptionValue)(options);
        const resourcesFolder = (0, options_1.resourcesFolderOptionValue)(options);
        const simulations = await (0, simulations_1.findSimulations)(sourcesFolder);
        const typescript = (0, options_1.typescriptOptionValueWithDefaults)(options, simulations);
        const { graalvmHome, jvmClasspath } = await (0, dependencies_1.resolveBundle)({ gatlingHome });
        log_1.logger.debug(`graalvmHome=${graalvmHome}`);
        log_1.logger.debug(`jvmClasspath=${jvmClasspath}`);
        await (0, run_1.runRecorder)({ graalvmHome, jvmClasspath, sourcesFolder, typescript, resourcesFolder });
    });
};
